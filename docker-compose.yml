version: '3'
services:
  iris:
    image: intersystemsdc/iris-community:preview
    ports:
      - 52773:52773
    command: 
      - -a
      - iris session iris -U%SYS '##class(Security.Users).UnExpireUserPasswords("*")'


  django:
    image: amirsamar/django-iris-todo:latest
    build: ./app
    depends_on:
      iris:
        condition: service_healthy
    ports:
      - 8000:8000
    volumes:
       - ./app:/usr/src/app/
    environment:
      - IRIS_JDBC_URL=jdbc:IRIS://iris:1972/USER
      - IRIS_USERNAME=SuperUser
      - IRIS_PASSWORD=SYS
